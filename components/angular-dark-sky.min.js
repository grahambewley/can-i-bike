/**
 * angular-dark-sky
 *
 * A simple & configurable provider for the Dark Sky API including icon directive using weather-icons
 *
 * @link https://github.com/deanbot/angular-dark-sky
 * @see {@link https://darksky.net/dev/}
 * @see {@link https://darksky.net/dev/docs/|Docs}
 * @see {@link http://erikflowers.github.io/weather-icons|weather-icons}
 * @author Dean Verleger <deanverleger@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";angular.module("dark-sky",[]).provider("darkSky",function(){var e,t={baseUri:"https://api.darksky.net/forecast/",baseExclude:"&exclude=",acceptedUnits:["auto","ca","uk2","us","si"],acceptedLanguage:["ar","az","be","bs","cs","de","el","en","es","fr","hr","hu","id","it","is","kw","nb","nl","pl","pt","ru","sk","sr","sv","tet","tr","uk","x-pig-latin","zh","zh-tw"]},n="us",r="en";this.setApiKey=function(t){return e=t,this},this.setUnits=function(e){return-1===t.acceptedUnits.indexOf(e)&&console.warn(e+" not an accepted API unit."),n=e,this},this.setLanguage=function(e){return-1===t.acceptedLanguage.indexOf(e)&&console.warn(e+" not an accepted API language."),r=e,this},this.$get=["$http","$q","$sce",function(i,a,u){function c(e,t,n){return s(e,t,n).daily()}function s(e,t,n){var r;return n&&n.time&&(r=n.time),{current:function(){var i=o("currently")+l(n);return f(e,t,i,r)},daily:function(){var i=o("daily")+l(n);return f(e,t,i,r)},hourly:function(){var i=o("hourly")+l(n);return f(e,t,i,r)},minutely:function(){var i=o("minutely")+l(n);return f(e,t,i,r)},alerts:function(){var i=o("alerts")+l(n);return f(e,t,i,r)},flags:function(){var i=o("flags")+l(n);return f(e,t,i,r)}}}function o(e){var n,r=["alerts","currently","daily","flags","hourly","minutely"],i=r.indexOf(e);return r.splice(i,1),n=r.join(","),t.baseExclude+n}function l(e){var t=p({},{extend:!1},e),n="";return e&&t.extend&&(n+="&extend=hourly"),n}function p(e){e=e||{};for(var t=1;t<arguments.length;t++)if(arguments[t])for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e}function f(c,s,o,l){c&&s||console.warn("no latitude or longitude sent to weather api");var l=l?", "+l:"",p=[t.baseUri,e,"/",c,",",s,l,"?units=",n,"&lang=",r,o].join("");return i.jsonp(u.trustAsResourceUrl(p)).then(function(e){return 200===parseInt(e.status)?e.data:a.reject(e)}).catch(function(e,t,n,r){return a.reject(t)})}function d(){return{nearestStormDistance:"mi",precipIntensity:"in/h",precipIntensityMax:"in/h",precipAccumulation:"in",temperature:"f",temperatureMin:"f",temperatureMax:"f",apparentTemperature:"f",dewPoint:"f",windSpeed:"mph",pressure:"mbar",visibility:"mi"}}function m(){return{nearestStormDistance:"km",precipIntensity:"mm/h",precipIntensityMax:"mm/h",precipAccumulation:"cm",temperature:"c",temperatureMin:"c",temperatureMax:"c",apparentTemperature:"c",dewPoint:"c",windSpeed:"mps",pressure:"hPa",visibility:"km"}}function y(){var e=d();return e.windSpeed="km/h",e}function h(){var e=m();return e.nearestStormDistance=e.visibility="mi",e.windSpeed="mph",e}var g={getCurrent:function(e,t,n){return s(e,t,n).current()},getForecast:c,getDailyForecast:c,getHourlyForecast:function(e,t,n){return s(e,t,n).hourly()},getMinutelyForecast:function(e,t,n){return s(e,t,n).minutely()},getAlerts:function(e,t,n){return s(e,t,n).alerts()},getFlags:function(e,t,n){return s(e,t,n).flags()},getUnits:function(){var e,t="us";switch(n&&("auto"===n?(console.warn("Can't guess units. Defaulting to Imperial"),t="us"):t=n),t){case"ca":e=y();break;case"uk2":e=h();break;case"us":e=d();break;case"si":e=m()}return e}};return e||console.warn("No Dark Sky API key set."),g}]}).directive("darkSkyIcon",["darkSky",function(e){return{restrict:"E",scope:{icon:"@"},template:'<i class="wi wi-forecast-io-{{ icon }} wi-dark-sky-{{ icon }}"></i>'}}])}();